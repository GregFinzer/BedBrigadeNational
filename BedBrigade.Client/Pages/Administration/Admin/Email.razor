@layout BedBrigade.Client.Shared.AdminLayout
@page "/administration/admin/email"
@inject IEmailQueueLogic EmailQueueLogic; 
@attribute [Authorize(Roles = RoleNames.CanSendBulkEmail)]

<h3>Send Email</h3>

<EditForm Model="@email" OnValidSubmit="@HandleSubmit">
    <div class="form-group">
        <label for="to">To:</label>
        <InputText id="to" class="form-control" @bind-Value="email.ToAddress" />
    </div>

    <div class="form-group">
        <label for="subject">Subject:</label>
        <InputText id="subject" class="form-control" @bind-Value="email.Subject" />
    </div>

    <div class="form-group">
        <label for="body">Body:</label>
        <InputTextArea id="body" class="form-control" @bind-Value="email.Body"></InputTextArea>
    </div>

    <button type="submit" class="btn btn-primary">Submit</button>
    <button type="button" class="btn btn-secondary" @onclick="ProcessQueue">Process Queue</button>
</EditForm>




@code {
    private EmailQueue email = new EmailQueue();

    private async Task HandleSubmit()
    {
        await EmailQueueLogic.QueueEmail(email);
        // // Logic to send email. For simplicity, we'll just print to console for now.
        // Console.WriteLine($"Sending email to: {email.To}, Subject: {email.Subject}, Body: {email.Body}");
    }

    private async Task ProcessQueue()
    {
        EmailQueueLogic.ProcessQueue(email);
    }
}