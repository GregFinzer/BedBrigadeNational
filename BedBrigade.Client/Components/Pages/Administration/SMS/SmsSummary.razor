@layout Layout.AdminLayout
@page "/administration/SMS/SmsSummary"

@using BedBrigade.Common.Models
@using FilterType = Syncfusion.Blazor.Grids.FilterType
@using EditMode = Syncfusion.Blazor.Grids.EditMode

<CheckAuth Roles=@RoleNames.CanViewSmsSummary></CheckAuth>

@if (SummaryList == null || Locations == null || CurrentLocationId == 0)
{
    <Spinner />
}
else
{

    @if (ShowLocationDropdown)
    {
        <div class="form-group mb-3 mt-3">
            <label for="locationDropdown">Location</label>
            <SfDropDownList ID="locationDropdown" TValue="int" TItem="Location" Placeholder="Select a location" DataSource="@Locations" @bind-Value="CurrentLocationId">
                <DropDownListFieldSettings Text="Name" Value="LocationId"></DropDownListFieldSettings>
                <DropDownListEvents TValue="int" TItem="Location" ValueChange="LocationChangeEvent"></DropDownListEvents>
            </SfDropDownList>
        </div>
    }

    <fieldset>
        <legend class="ms-3">Text Message Summary</legend>
        <div class="col-md-12 control-sec">
            <div class="content-wrapper">
                <div class="row">
                    <SfGrid @ref="Grid" TValue="SmsQueueSummary" DataSource=@SummaryList
                            ContextMenuItems=@ContextMenu
                            EnablePersistence="true"
                            ShowColumnChooser="true"
                            Toolbar=@ToolBar
                            AllowPaging="true"
                            AllowSorting="true"
                            AllowExcelExport="true"
                            ShowColumnMenu="true"
                            AllowFiltering="true"
                            AllowReordering="true"
                            AllowResizing="true"
                            AllowSelection="true"
                            AllowPdfExport="true"
                            AllowTextWrap="true"
                            AllowAdding="false"
                            AllowDeleting="false"
                            AllowEditing="false"
                            Width="100%">
                        <GridPageSettings PageSizes="@(new int[]{5,10,15,20,25})" PageSize="15" />
                        <GridEvents Destroyed=@OnDestroyed OnLoad=@OnLoad DataBound=@DataBound OnToolbarClick=@OnToolBarClick OnActionBegin=@OnActionBegin RowDataBound="OnRowBound" RowSelected="OnRowSelected" TValue="SmsQueueSummary" />
                        <GridTemplates>
                            <EmptyRecordTemplate>
                                <span>@RecordText</span>
                            </EmptyRecordTemplate>
                        </GridTemplates>
                        <GridFilterSettings Type="FilterType.CheckBox"></GridFilterSettings>
                        <GridSortSettings>
                            <GridSortColumns>
                                <GridSortColumn Field="@nameof(SmsQueueSummary.MessageDate)" Direction="SortDirection.Descending" />
                            </GridSortColumns>
                        </GridSortSettings>
                        <GridColumns>
                            <GridColumn Field=@nameof(SmsQueueSummary.ContactName) HeaderText="Name" AutoFit="true"/>
                            <GridColumn Field=@nameof(SmsQueueSummary.ToPhoneNumber) IsPrimaryKey="true" HeaderText="Phone" Type="ColumnType.String" AutoFit="true"/>
                            <GridColumn Field=@nameof(SmsQueueSummary.MessageDate) HeaderText="Date" Type="ColumnType.DateTime" Format="MM/dd/yyyy hh:mm tt" AllowFiltering="true" ShowInColumnChooser="true" AutoFit="true"/>
                            <GridColumn Field=@nameof(SmsQueueSummary.Body) HeaderText="Last Message"/>
                            <GridColumn Field=@nameof(SmsQueueSummary.ContactType) HeaderText="Contact Type" AutoFit="true"/>
                            <GridColumn Field=@nameof(SmsQueueSummary.MessageCount) HeaderText="Count" AutoFit="true"/>
                        </GridColumns>
                    </SfGrid>

                </div>
            </div>
        </div>
    </fieldset>
}
<style>
    .new-message {
        background-color: lightblue;
    }
</style>