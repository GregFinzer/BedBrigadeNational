@layout Layout.AdminLayout
@page "/administration/manage/sign-ups"
<CheckAuth Roles=@RoleNames.CanViewSignUps></CheckAuth>

@using BedBrigade.Common.Models

<div class="row mt-3">
    <div class="col-md-6 ps-3">
        <h3>@ManageSignUpsMessage</h3>
    </div>
    <div class="col-md-4 ps-3 ps-md-0">
        <label for="VolunteerSelector" style="display: inline-block;">Scheduled</label>
        <SfDropDownList id="VolunteerSelector" CssClass="periodselector" TValue="string" TItem="GridFilterOption" Placeholder="Select a grid filter" DataSource="@GridFilterOptions" @bind-Value="@CurrentFilter" Width="300px">
            <DropDownListEvents TItem="GridFilterOption" TValue="string" ValueChange="OnFilterChange"></DropDownListEvents>
            <DropDownListFieldSettings Value="ID" Text="Text"></DropDownListFieldSettings>
        </SfDropDownList>
    </div>
    <div class="col-md-2 ps-3 ps-md-0">
        <UserInfo />
    </div>
</div>


<div class="row" style="display: @GridDisplay">
    <div class="content-wrapper col-md-12">
        <div style="width: 100%">
            <SfGrid @ref="Grid" TValue="SignUpDisplayItem"
                    DataSource=@SignUpDisplayItems
                    Width="100%"
                    EnablePersistence="true"
                    ShowColumnChooser="true"
                    Toolbar=@Toolbaritems
                    AllowPaging="true"
                    AllowSorting="true"
                    AllowExcelExport="true"
                    ShowColumnMenu="false"
                    AllowFiltering="true"
                    AllowReordering="true"
                    AllowResizing="true"
                    AllowSelection="true"
                    AllowPdfExport="true"
                    AllowTextWrap="false"
                    AllowGrouping="false"
                    ClipMode="ClipMode.EllipsisWithTooltip">

                <GridPageSettings PageSizes="@(new int[] { 5, 10, 15, 20, 25, 50, 100 })" PageSize="15" />
                <GridEvents Destroyed=@OnDestroyed OnLoad=@OnLoad OnToolbarClick="ToolbarClickHandler" TValue="SignUpDisplayItem" RowSelected="GetSelectedRecords"></GridEvents>
                <GridSelectionSettings Type="Syncfusion.Blazor.Grids.SelectionType.Single"></GridSelectionSettings>

                <GridTemplates>
                    <EmptyRecordTemplate>
                        <span>@RecordText</span>
                    </EmptyRecordTemplate>
                </GridTemplates>

                <GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.CheckBox"></GridFilterSettings>

                <GridSortSettings>
                    <GridSortColumns>
                        <GridSortColumn Field="ScheduleEventDate" Direction="SortDirection.Ascending" />
                    </GridSortColumns>
                </GridSortSettings>

                <GridColumns>

                    <GridColumn Field=@nameof(SignUpDisplayItem.SignUpGridId) Visible="false" IsPrimaryKey="true" HeaderText="PRID" TextAlign="TextAlign.Left" AutoFit="false" AllowFiltering="true" AllowEditing="false" AllowAdding="false"></GridColumn>
                    <GridColumn Field=@nameof(SignUpDisplayItem.SignUpId) Visible="false" HeaderText="Reg ID" TextAlign="TextAlign.Right" AutoFit="false" AllowFiltering="true" AllowEditing="false" AllowAdding="false"></GridColumn>
                    <GridColumn Field=@nameof(SignUpDisplayItem.ScheduleLocationId) Visible="false" HeaderText="Loc ID" TextAlign="TextAlign.Right" AutoFit="false" AllowFiltering="true" AllowEditing="false" AllowAdding="false"></GridColumn>
                    <GridColumn Field=@nameof(SignUpDisplayItem.ScheduleId) Visible="false" HeaderText="Event ID" TextAlign="TextAlign.Right" AutoFit="false" AllowFiltering="true" AllowEditing="false" AllowAdding="false"></GridColumn>
                    <GridColumn Field=@nameof(SignUpDisplayItem.ScheduleEventName) HeaderText="Event Name" Type="ColumnType.String" Width="150px" AllowEditing="false" AllowFiltering="true" AutoFit="false" AllowSorting="true" />
                    <GridColumn Field=@nameof(SignUpDisplayItem.ScheduleEventDate) HeaderText="Event Date" Format="MM/dd/yyyy hh:mm tt" Type="ColumnType.Date" Width="150px" AllowEditing="false" AllowFiltering="true" AutoFit="false" />

                    <GridColumn Field=@nameof(SignUpDisplayItem.VolunteerId) Visible="false" HeaderText="Vol ID" TextAlign="TextAlign.Right" IsPrimaryKey="true" AutoFit="false" AllowFiltering="false" AllowEditing="false" AllowAdding="false"></GridColumn>
                    <GridColumn Field=@nameof(SignUpDisplayItem.VolunteerFullName) HeaderText="Volunteer Name" Type="ColumnType.String" Width="175px" AllowEditing="false" AllowFiltering="true" AutoFit="false" AllowSorting="true" />
                    <GridColumn Field=@nameof(SignUpDisplayItem.VolunteerEmail) HeaderText="Email" Type="ColumnType.String" Width="250px" AllowEditing="false" AllowFiltering="true" AutoFit="false" />
                    <GridColumn Field=@nameof(SignUpDisplayItem.VolunteerFormattedPhone) HeaderText="Phone" Type="ColumnType.String" Width="125px" AllowEditing="false" AllowFiltering="false" AutoFit="false" />
                    <GridColumn Field=@nameof(SignUpDisplayItem.VolunteerOrganization) HeaderText="Organization" Type="ColumnType.String" Width="200px" AllowEditing="false" AllowFiltering="true" AutoFit="false" />
                    <GridColumn Field=@nameof(SignUpDisplayItem.VehicleTypeString) Width="200px" HeaderText="Vehicle Type" Type="ColumnType.String" AllowEditing="false" AllowGrouping="false" AllowFiltering="false" AutoFit="false" />
                    <GridColumn Field=@nameof(SignUpDisplayItem.SignUpNumberOfVolunteers) Width="100px" HeaderText="# Volunteers" AllowFiltering="false" AutoFit="false" CustomAttributes="@(new Dictionary<string, object> { { "class", "center-column" } })"></GridColumn>
                    <GridColumn Field=@nameof(SignUpDisplayItem.SignUpNote) HeaderText="Notes" Width="400px" Type="ColumnType.String" HeaderTextAlign="TextAlign.Left" AllowEditing="false" AllowFiltering="false" />
                    <GridColumn Field=@nameof(SignUpDisplayItem.CreateDateLocal) Width="150px" HeaderText="Registration Date" Format="MM/dd/yyyy hh:mm tt" Type="ColumnType.Date" AllowEditing="false" AllowFiltering="false" AutoFit="false" />
                    <GridColumn Field=@nameof(SignUpDisplayItem.IHaveVolunteeredBefore) Width="200px" Type="ColumnType.Boolean" HeaderText="Previous Volunteer" AllowEditing="false" AllowFiltering="true" EditType="EditType.BooleanEdit" DisplayAsCheckBox="true" AutoFit="false" CustomAttributes="@(new Dictionary<string, object> { { "class", "center-column" } })" />
                </GridColumns>
            </SfGrid>
        </div>
    </div>
</div>


@if (ShowEditDialog)
{
    <div class="modal" tabindex="-1" role="dialog" style="display: @(ShowEditDialog ? "block" : "none")">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">@DialogTitle</h5>
                </div>
                @AvailabilityMessage
                <div class="modal-body" style="display: @DisplaySearchPanel">
                    <SfTab>
                        <TabItems>
                            <TabItem>
                                <ChildContent>
                                    <TabHeader Text="Choose"></TabHeader>
                                </ChildContent>
                                <ContentTemplate>
                                    <SfDropDownList TValue="string" TItem="Volunteer" Placeholder="Select a Volunteer" DataSource="@lstLocationVolunteers">
                                        <DropDownListFieldSettings Value="VolunteerId" Text="SearchName"></DropDownListFieldSettings>
                                        <DropDownListEvents TItem="Volunteer" TValue="string" ValueChange="OnVolunteerSelect"></DropDownListEvents>
                                    </SfDropDownList>
                                </ContentTemplate>
                            </TabItem>
                            <TabItem>
                                <ChildContent>
                                    <TabHeader Text="Search"></TabHeader>
                                </ChildContent>
                                <ContentTemplate>
                                    <SfAutoComplete TValue="string" TItem="Volunteer" Placeholder="Seach a Volunteer by Name" DataSource="@lstLocationVolunteers">
                                        <AutoCompleteFieldSettings Value="SearchName"></AutoCompleteFieldSettings>
                                        <AutoCompleteEvents TValue="string" TItem="Volunteer" ValueChange="OnVolunteerSelect"></AutoCompleteEvents>
                                    </SfAutoComplete>
                                </ContentTemplate>
                            </TabItem>
                        </TabItems>
                    </SfTab>
                </div>
                <div class="modal-body" style="display: @DisplayDataPanel">
                    <div class="row">
                        <div class="col">
                            <div class="card">
                                <div class="card-title" style="text-align: center;  background-color: #DEDEDE"><b>Event</b></div>
                                <div class="card-body">
                                    <table class="table table-striped table-sm">
                                        <tr>
                                            <td style="vertical-align: top">Location:</td>
                                            <th style="vertical-align: top">@StringUtil.IsNull(selectedGridObject.ScheduleLocationName, "")</th>
                                        </tr>
                                        <tr>
                                            <td style="vertical-align: top">Name:</td>
                                            <th style="vertical-align: top">@selectedGridObject.ScheduleEventName</th>
                                        </tr>
                                        <tr>
                                            <td style="vertical-align: top">Date:</td>
                                            <th style="vertical-align: top">@DateUtil.GetFormattedDateTime(selectedGridObject.ScheduleEventDate)</th>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="card">
                                <div class="card-title" style="text-align: center; background-color: #DEDEDE"><b>Volunteer</b></div>
                                <div class="card-body">
                                    <table class="table table-striped table-sm" style="display: @displayVolunteerData">
                                        <tr>
                                            <td style="vertical-align: top">Name:</td>
                                            <th style="vertical-align: top">@newSignUp.VolunteerFullName</th>
                                        </tr>
                                        <tr>
                                            <td style="vertical-align: top">Phone:</td>
                                            <th style="vertical-align: top; white-space: nowrap">@newSignUp.VolunteerFormattedPhone</th>
                                        </tr>
                                        <tr>
                                            <td style="vertical-align: top">Email:</td>
                                            <th style="vertical-align: top">@newSignUp.VolunteerEmail</th>
                                        </tr>
                                        <tr>
                                            <td style="vertical-align: top; white-space: nowrap">Vehicle Type</td>
                                            <th style="vertical-align: top">@(newSignUp.VehicleType.HasValue ? @EnumHelper.GetEnumDescription(newSignUp.VehicleType.Value) : string.Empty)</th>
                                        </tr>
                                        <tr>
                                            <td style="vertical-align: top; white-space: nowrap">Number of Volunteers</td>
                                            <th style="vertical-align: top"><SfNumericTextBox ID="numberOfVolunteers" TValue="int" Min="1" Max="100" @bind-Value="newSignUp.SignUpNumberOfVolunteers"></SfNumericTextBox></th>
                                        </tr>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-body">
                    @DialogMessage
                </div>
                <div class="modal-footer">
                    <button type="button" style="display: @DisplayAddButton" class="btn btn-primary" @onclick="@(() => onConfirmAdd())">Ok</button>&nbsp;
                    <button type="button" style="display: @DisplayDeleteButton" class="btn btn-primary" @onclick="@(() => onConfirmDelete())">Ok</button>&nbsp;
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" @onclick="@(() => this.ShowEditDialog = false)">@CloseButtonCaption</button>
                </div>
            </div>
        </div>
    </div>
}


@ErrorMessage

<style type="text/css">

    .center-column {
        text-align: center;
    }
</style>
