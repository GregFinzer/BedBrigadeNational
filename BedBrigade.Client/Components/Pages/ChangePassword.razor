@page "/change-password/{email:nonfile}/{hash:nonfile}"
@namespace BedBrigade.Client.Components.Pages
@using System.ComponentModel.DataAnnotations

<PageTitle>Change Password</PageTitle>

<div class="container my-4">
    <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">

            @if (_loading)
            {
                <div class="text-center py-5">
                    <div class="spinner-border" role="status" aria-label="Loading"></div>
                </div>
            }
            else if (!string.IsNullOrEmpty(_errorMessage))
            {
                <div class="alert alert-danger d-flex justify-content-between align-items-center" role="alert">
                    <span>@_errorMessage</span>
                    <a class="alert-link ms-2" href="/forgot-password">Forgot password</a>
                </div>
            }
            else if (_success)
            {
                <div class="alert alert-success" role="alert">
                    Your password has been changed successfully. You can now <a class="alert-link" href="/login">sign in</a>.
                </div>
            }
            else if (_hashValid && _user is not null)
            {
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h1 class="h4 mb-3">Change Password</h1>

                        <EditForm Model="_model" OnValidSubmit="OnSubmitAsync">
                            <DataAnnotationsValidator />
                            <ValidationSummary />

                            <div class="mb-3">
                                <label for="password" class="form-label">New Password</label>
                                <InputText id="password"
                                           class="form-control"
                                           type="@(_showPassword ? "text" : "password")"
                                           @bind-Value="_model.Password"
                                           autocomplete="new-password" />
                                <div class="form-text">
                                    Minimum 8 chars with at least 1 upper, 1 lower, 1 number, and 1 special character.
                                </div>
                                <ValidationMessage For="@(() => _model.Password)" />
                            </div>

                            <div class="mb-3">
                                <label for="confirmPassword" class="form-label">Confirm Password</label>
                                <InputText id="confirmPassword"
                                           class="form-control"
                                           type="@(_showPassword ? "text" : "password")"
                                           @bind-Value="_model.ConfirmPassword"
                                           autocomplete="new-password" />
                                <ValidationMessage For="@(() => _model.ConfirmPassword)" />
                            </div>

                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="showPassword" @bind="_showPassword" />
                                <label class="form-check-label" for="showPassword">
                                    Show Password
                                </label>
                            </div>

                            <button type="submit" class="btn btn-primary" disabled="@_busy">
                                @if (_busy)
                                {
                                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                }
                                Change Password
                            </button>
                        </EditForm>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
