@page "/"
@page "/{mylocation:nonfile}"
@page "/{mylocation}/{mypageName:nonfile}"
@using BedBrigade.Client.Services
@using Serilog

<MyBody @ref="myBody"/>

@code {
    MyBody myBody;
    [Inject] private IJSRuntime _js { get; set; }

    [Inject]
    private IHeaderLocationState _headerLocationState  {  get; set; }

    [Inject]
    private IFooterLocationState _footerLocationState { get; set; }

    [Parameter] public string? mylocation { get; set; }
    [Parameter] public string? mypageName { get; set; }
    public string location { get; set; } 
    public string pageName { get; set; } 
    const string defaultLocation = "National";
    const string defaultPageName = "Home";

    protected override async Task OnParametersSetAsync()
    {
        location = string.IsNullOrEmpty(mylocation) ? defaultLocation : mylocation;
        pageName = string.IsNullOrEmpty(mypageName) ? defaultPageName : mypageName;
        _headerLocationState.Location = location; // Update the state
        _footerLocationState.Location = location + string.Empty; // Update the state
        mylocation = null;
        mypageName = null;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {

        string message = $"Calling {mypageName ?? defaultPageName} for location {mylocation ?? defaultLocation}";
        Log.Logger.Debug(message);

        if (!firstRender)
        {
            Log.Logger.Debug("LoadBody");
            await myBody.LoadBody();
            Log.Logger.Debug("RefreshState");
            myBody.RefreshState();
        }
    }
}
